<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">

<!-- Mirrored from sambapos.org/wiki/doku.php/en/redeeming_coupons by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 10 Jan 2019 04:45:35 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <title>Redeeming Coupons [SambaPOS V3]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="theme-color" content="#008800"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="en,redeeming_coupons"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://sambapos.org/wiki/lib/exe/opensearch.php" title="SambaPOS V3"/>
<link rel="start" href="https://sambapos.org/wiki/"/>
<link rel="contents" href="redeeming_couponsdecf.html?do=index" title="Sitemap"/>
<link rel="manifest" href="https://sambapos.org/wiki/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="https://sambapos.org/wiki/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="https://sambapos.org/wiki/feed.php?mode=list&amp;ns=en"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="redeeming_coupons47cd.html?do=export_xhtml"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="redeeming_couponsf7dc.txt?do=export_raw"/>
<link rel="canonical" href="redeeming_coupons.html"/>
<link rel="stylesheet" type="text/css" href="https://sambapos.org/wiki/lib/exe/css.php?t=dokuwiki&amp;tseed=c8874b19d6985f85f27e1d0baa627941"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='en';var JSINFO = {"plugin_aceeditor":{"default":1,"highlight":1,"wraplimit":80,"colortheme":"textmate","latex":1,"markdown":1,"mdpage":false,"xmltags":[]},"ga":{"trackingId":"UA-2397752-18","anonymizeIp":true,"action":"show","trackOutboundLinks":false,"options":[],"pageview":"\/wiki\/en\/redeeming_coupons"},"id":"en:redeeming_coupons","namespace":"en","ACT":"show","useHeadingNavigation":1,"useHeadingContent":1};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="https://sambapos.org/wiki/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="https://sambapos.org/wiki/lib/exe/js.php?t=dokuwiki&amp;tseed=c8874b19d6985f85f27e1d0baa627941&amp;lang=en"></script>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="https://sambapos.org/wiki/lib/tpl/dokuwiki/images/favicon.ico" />
<link rel="apple-touch-icon" href="../../lib/tpl/dokuwiki/images/apple-touch-icon.png" />
    </head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_dokuwiki    showSidebar hasSidebar">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="https://sambapos.org/wiki/doku.php/p"  accesskey="h" title="[H]"><img src="../../lib/exe/fetch.php/wiki/logo.png_%3b" width="70" height="70" alt="" /> <span>SambaPOS V3</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li class="action login"><a href="redeeming_coupons51ef.html?do=login&amp;sectok=" title="Log In" rel="nofollow"><span>Log In</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10 17.25V14H3v-4h7V6.75L15.25 12 10 17.25M8 2h9a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-4h2v4h9V4H8v4H6V4a2 2 0 0 1 2-2z"/></svg></a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="https://sambapos.org/wiki/doku.php/p" method="get" role="search" class="search doku_form" id="dw__search" accept-charset="utf-8"><input type="hidden" name="do" value="search" /><input type="hidden" name="id" value="en:redeeming_coupons" /><div class="no"><input name="q" type="text" class="edit" title="[F]" accesskey="f" placeholder="Search" autocomplete="on" id="qsearch__in" value="" /><button value="1" type="submit" title="Search">Search</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="https://sambapos.org/wiki/doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="en:redeeming_coupons" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Show pagesource</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent Changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Log In</option></optgroup></select><button type="submit">&gt;</button></div></form>            </div>
            <ul>
                <li class="action recent"><a href="redeeming_coupons810b.html?do=recent" title="Recent Changes [r]" rel="nofollow" accesskey="r">Recent Changes</a></li><li class="action media"><a href="redeeming_couponsb4e1.html?do=media&amp;ns=en" title="Media Manager" rel="nofollow">Media Manager</a></li><li class="action index"><a href="redeeming_couponsdecf.html?do=index" title="Sitemap [x]" rel="nofollow" accesskey="x">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                                        <div class="trace"><span class="bchead">Trace:</span> <span class="bcsep">•</span> <bdi><a href="installing_sql_express_2012_for_sambapos_v3.html"  class="breadcrumbs" title="en:installing_sql_express_2012_for_sambapos_v3">Installing SQL Express 2012 for SambaPOS V3</a></bdi> <span class="bcsep">•</span> <bdi><a href="tips_tricks_for_new_users.html"  class="breadcrumbs" title="en:tips_tricks_for_new_users">Tips &amp; Tricks for new users.</a></bdi> <span class="bcsep">•</span> <bdi><a href="auto_rounding.html"  class="breadcrumbs" title="en:auto_rounding">Auto Rounding</a></bdi> <span class="bcsep">•</span> <bdi><a href="barcode_printing_tags.html"  class="breadcrumbs" title="en:barcode_printing_tags">Barcode Printing Tags</a></bdi> <span class="bcsep">•</span> <bdi><a href="random_number_generator_tag.html"  class="breadcrumbs" title="en:random_number_generator_tag">Random Number Generator Tags</a></bdi> <span class="bcsep">•</span> <bdi><a href="primary_field_editing_formats.html"  class="breadcrumbs" title="en:primary_field_editing_formats">Primary Field Editing Formats</a></bdi> <span class="bcsep">•</span> <bdi><a href="task_widget.html"  class="breadcrumbs" title="en:task_widget">Task Widget</a></bdi> <span class="bcsep">•</span> <bdi><a href="modify_variable_action.html"  class="breadcrumbs" title="en:modify_variable_action">Modify Variable Action</a></bdi> <span class="bcsep">•</span> <bdi><a href="preparing_sambapos_to_sell_coffee_coupons.html"  class="breadcrumbs" title="en:preparing_sambapos_to_sell_coffee_coupons">Preparing SambaPOS to Sell Coffee Coupons</a></bdi> <span class="bcsep">•</span> <span class="curid"><bdi><a href="redeeming_coupons.html"  class="breadcrumbs" title="en:redeeming_coupons">Redeeming Coupons</a></bdi></span></div>
                    </div>
    


    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

                            <!-- ********** ASIDE ********** -->
                <div id="dokuwiki__aside"><div class="pad aside include group">
                    <h3 class="toggle">Sidebar</h3>
                    <div class="content"><div class="group">
                                                Languages:
<div class="plugin_translation"><form action="https://sambapos.org/wiki/doku.php/p" id="translation__dropdown"><select name="id" class="wikilink1"><option class="wikilink1 cur" title="English" value="en/redeeming_coupons" selected="selected">en</option><option class="wikilink2" title="Türkçe" value="tr/redeeming_coupons">tr</option></select><input name="go" type="submit" value="&rarr;" /></form></div>                        
<p>
<strong>Languages:</strong>
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://sambapos.org/wiki/doku.php/tr/p" class="urlextern" title="http://sambapos.org/wiki/doku.php/tr/p" rel="nofollow">Turkish</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://sambapos.org/wiki/doku.php/p?id=en/p" class="urlextern" title="http://sambapos.org/wiki/doku.php/p?id=en/p" rel="nofollow">English</a></div>
</li>
</ul>

<p>
<strong>Links - SambaPOS V4</strong>
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://www.sambapos.com/" class="urlextern" title="http://www.sambapos.com" rel="nofollow">SambaPOS V4 WebSite</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://dorum.sambapos.org/" class="urlextern" title="http://dorum.sambapos.org" rel="nofollow">SambaPOS V4 Forum</a></div>
</li>
</ul>

<p>
<strong>Links</strong>
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://www.sambapos.org/" class="urlextern" title="http://www.sambapos.org" rel="nofollow">SambaPOS Web Site</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.sambapos.org/" class="urlextern" title="http://www.sambapos.org" rel="nofollow">Forum</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.sambapos.org/en/downloads" class="urlextern" title="http://www.sambapos.org/en/downloads" rel="nofollow">Download</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.sambapos.org/wiki" class="urlextern" title="http://www.sambapos.org/wiki" rel="nofollow">Documantation</a></div>
</li>
</ul>

<p>
<strong>Links - SambaPOS V2</strong>
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://v2.sambapos.org/" class="urlextern" title="http://v2.sambapos.org" rel="nofollow">SambaPOS V2 WebSite</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://forum2.sambapos.org/" class="urlextern" title="http://forum2.sambapos.org" rel="nofollow">Forum</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://sambapos.googlecode.com/" class="urlextern" title="http://sambapos.googlecode.com" rel="nofollow">Download</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://doc.sambapos.org/" class="urlextern" title="http://doc.sambapos.org" rel="nofollow">Dökümantasyon</a></div>
</li>
</ul>

<p>
<strong>Links - Social Media</strong>
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://www.facebook.com/sambapos" class="urlextern" title="http://www.facebook.com/sambapos" rel="nofollow">Facebook</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://www.twitter.com/sambapos" class="urlextern" title="https://www.twitter.com/sambapos" rel="nofollow">Twitter</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.youtube.com/user/sambapos" class="urlextern" title="http://www.youtube.com/user/sambapos" rel="nofollow">Youtube</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://vimeo.com/sambapos" class="urlextern" title="http://vimeo.com/sambapos" rel="nofollow">Vimeo</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.pinterest.com/sambapos" class="urlextern" title="http://www.pinterest.com/sambapos" rel="nofollow">Pinterest</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.flickr.com/photos/sambapos" class="urlextern" title="http://www.flickr.com/photos/sambapos" rel="nofollow">Flickr</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://instagram.com/sambapos" class="urlextern" title="http://instagram.com/sambapos" rel="nofollow">Instagram</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://sambapos.tumblr.com/" class="urlextern" title="http://sambapos.tumblr.com" rel="nofollow">Tumblr</a></div>
</li>
</ul>

<p>
—-
</p>
                                            </div></div>
                </div></div><!-- /aside -->
            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span>en:redeeming_coupons</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#redeeming_coupons">Redeeming Coupons</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#finding_coupons">Finding Coupons</a></div></li>
<li class="level2"><div class="li"><a href="#adding_free_products_into_ticket">Adding Free Products Into Ticket</a></div></li>
<li class="level2"><div class="li"><a href="#storing_coupon_data_on_order_lines">Storing Coupon Data on Order Lines</a></div></li>
<li class="level2"><div class="li"><a href="#canceling_and_submitting_promotion_orders">Canceling and Submitting Promotion Orders</a></div></li>
<li class="level2"><div class="li"><a href="#creating_operator_feedbacks">Creating Operator Feedbacks</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="redeeming_coupons">Redeeming Coupons</h1>
<div class="level1">

<p>
When a coupon number is typed or a coupon QR Tag scanned, SambaPOS will find related coupon entity and assign it to the ticket. That will automatically create a gift order for the product associated with coupon. As ticket submitted we’ll mark coupon as Redeemed to prevent multiple uses of coupons. 
</p>

<p>
We’ll also solve another security issue by updating coupon redeem status as <code>In Ticket</code> as soon as it scanned. So multiple scans will not generate multiple gift lines. In fact we can do the same thing by directly updating coupon status as redeemed but we want to allow operators to cancel a coupon scan before submitting it. 
</p>

</div>

<h2 class="sectionedit2" id="finding_coupons">Finding Coupons</h2>
<div class="level2">

<p>
We need an action to find and assign coupons to ticket. Since coupons are entities we can use “Change Ticket Entity” action to assign a coupon to the ticket.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons16c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons16.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons164710.jpg_%3b?w=700&amp;tok=35ec02" class="media" alt="" width="700" /></a>
</p>

<p>
<code>Can Create Ticket</code> parameter is useful for Fast Food screens. If there is no active ticket displayed when this action is called it creates a new ticket. While using this action we’ll generally find entities by their name. We can use both <code>Entity Search Value</code> or <code>Entity Name</code> parameters but they have different effects. Searching by Entity Name will retrieve entity from cache so you won’t have latest changes on entity data. It is useful to load rarely changing entities like Tables. Since we always need updated entity data we’ll use Entity Search Value. 
</p>

<p>
We’ll use number pad editor to type or scan coupon numbers. When we enter a number there <code>Number Pad Value Entered</code> Event executes so we can create a rule for that event to read which coupon is scanned.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons17c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons17.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons179f91.jpg_%3b?w=700&amp;tok=72d93d" class="media" alt="" width="700" /></a>
</p>

<p>
We can read scanned numbers with “NumberpadValue” parameter but at first we should check if it is a valid coupon code. We’ll create two custom constraints to check if scanned number starts with CP prefix and length equals to 11 digits. Notice how we changed Execute If setting to <code>Matches All</code> to force rule to validate all constraints. Don’t forget adding default mapping before saving the rule.
</p>

<p>
Now when we scan a valid coupon number it should create a new ticket with Coupon number displayed on header. 
</p>

<p>
On previous chapter we’ve created a Coupon numbered as <code>CP8GS-DZC-38S</code>. We’ll type it manually for testing if our rule works or not. Normally we’ll scan it from a barcode or QR Tag.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons18c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons18.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons18327c.jpg_%3b?w=700&amp;tok=f60816" class="media" alt="" width="700" /></a>
</p>

<p>
This is a Fast Food screen so there is no active ticket. Change Ticket Entity action should create a ticket before assigning coupon to the ticket. 
Now you can hit Enter. 
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons19c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons19.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons197169.jpg_%3b?w=700&amp;tok=8ec202" class="media" alt="" width="700" /></a>
</p>

<p>
New ticket created with Coupon Number displayed on header. That means our action and rule works fine.
</p>
<div class="wrap_center wrap_round wrap_tip plugin_wrap" style="width: 60%;">
<p>
Don’t worry if Coupon number not appeared on header. Because of an optimization to avoid unnecessary refreshes sometimes that happens. We can execute “Display Ticket” action to force itself to refresh but on next steps we’ll copy coupon number to order line and remove it from ticket header. So it is not needed. If you want to see updated header just add an order and cancel it.
</p>
</div>
<p>
Close this ticket without adding any item in it. On next step we’ll create another action to add Free Coffee into Ticket when a coupon scanned. 
</p>

</div>

<h2 class="sectionedit5" id="adding_free_products_into_ticket">Adding Free Products Into Ticket</h2>
<div class="level2">

<p>
We can use <code>Add Order</code> action to add orders into a ticket.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons20c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons20.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons208298.jpg_%3b?w=700&amp;tok=5958cf" class="media" alt="" width="700" /></a>
</p>

<p>
Menu Item Name parameter contains a variable called [:Product Name]. We’ll assign this value from Coupon. We’ll also update GStatus state as free. GStatus is an internal order state group for Gift and Void states. Instead of marking it as Gift we’ll mark it as <code>Free</code> so Gift and Cancel Gift buttons will not work for this order. Decrease Inventory parameter is <code>True</code> so it will decrease our inventory. Calculate Price parameter is <code>False</code> so this order will display the price but won’t change ticket total like Gift orders.
</p>

<p>
You can consider enabling Locked parameter to disable canceling this order. For this tutorial we’ll permit canceling coupon orders before submitting. 
</p>

<p>
We’ll create a rule for “Ticket Entity Changed” event to execute this action when a Coupon scanned. 
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons21c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons21.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons21512a.jpg_%3b?w=700&amp;tok=94820f" class="media" alt="" width="700" /></a>
</p>

<p>
When any ticket entity changes “Ticket Entity Changed” event fires. First we need to create constraints to be able to understand selected entity is a Coupon. So <code>Entity Type Name</code> should be <code>Coupons</code> and <code>New Entity Name</code> should be anything different than *. This is a change event so it executes when we remove Entities form ticket. If entity name equals *  that means Coupon Removed from ticket. 
</p>

<p>
We won’t execute Add Gift Order action if coupon is already redeemed. So on third line of the constraint we are checking Redeem status. 
</p>

<p>
If selected entity is a Coupon we’ll execute “Add Gift Order” action. We’ll read product name from Coupon’s Menu Item Name with {ENTITY DATA:Coupon:Menu Item Name} tag.
</p>

<p>
Now let’s test again what will happen when we enter a coupon code.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons22c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons22.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons22cc2d.jpg_%3b?w=700&amp;tok=2edab5" class="media" alt="" width="700" /></a>
</p>

<p>
That worked fine. When we scan a coupon number it adds a free coffee into the ticket.
</p>

<p>
On next step we have to solve another issue. We’re displaying coupon number on ticket header but we’ll loose this information when we scan another coupon. You can forbid multiple coupons on a single ticket but for this example we’ll allow it. To be able to support multiple coupons on a single ticket we need to store coupon numbers on order lines. 
</p>

</div>

<h2 class="sectionedit6" id="storing_coupon_data_on_order_lines">Storing Coupon Data on Order Lines</h2>
<div class="level2">

<p>
We’ll create a <code>Update Order State</code> action to store Coupon Numbers on order.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons23c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons23.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons2354a4.jpg_%3b?w=700&amp;tok=471e78" class="media" alt="" width="700" /></a>
</p>

<p>
This action updates <code>Coupon Number</code> state of the order. We’ll call this action from last <code>Ticket Entity Changed</code> rule we’ve created. So after adding free coffee order it will also update coupon number of the order line.
</p>

<p>
So we can edit <code>Add Free Product when Coupon Loaded</code> rule and add this action after <code>Add Gift Order</code> action.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons24c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons24.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons249005.jpg_%3b?w=700&amp;tok=61e204" class="media" alt="" width="700" /></a>
</p>

<p>
As shown on the screenshot we&#039;ll type <code>{ENTITY NAME:Coupon}</code> tag to read current Coupon&#039;s number from ticket entity and pass it to <code>Coupon Number</code> parameter of the action.
</p>

<p>
After updating Coupon Number we can change Coupon’s Redeemed status as <code>In Ticket</code> so multiple scanning of a coupon number won’t generate multiple gifts. Since we’ll immediately update this data, scanning coupon from other terminals will also not work. This is a big issue for most POS software but we can solve it. We’ll call <code>Update Coupon Redeem Status</code> action to update Coupon. 
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons25c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons25.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons25f728.jpg_%3b?w=700&amp;tok=182243" class="media" alt="" width="700" /></a>
</p>

<p>
To be able to update coupon correctly we’ll set Coupon Number variable with <code>{ENTITY NAME:Coupon}</code> tag. We’ll also use “In Ticket” as Value. 
</p>

<p>
We don’t need storing Coupon Number on ticket header anymore because we are storing it on order line. We can call <code>Load Coupon to Ticket</code> action to remove coupon from ticket header. It will also release coupon so since coupon entity is not assigned to a ticket we can delete redeemed coupons to keep your coupon list fresh and clean. 
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons26c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons26.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons26d528.jpg_%3b?w=700&amp;tok=8e93f2" class="media" alt="" width="700" /></a>
</p>

<p>
We’ll enter * as Coupon number so it will remove Coupon from ticket header. Since this action changes Ticket Entity it will execute <code>Ticket Entity Changed</code> event again but we already prevented it from executing by adding a constraint for new entity name parameter and checking if it is different than *. 
</p>

<p>
We can go back to POS screen and test what will happen after these changes. 
Enter the Coupon Number again and hit enter.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons27c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons27.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons2740bb.jpg_%3b?w=700&amp;tok=44d2f3" class="media" alt="" width="700" /></a>
</p>

<p>
Perfect! We can see coupon number on order line and there is nothing on ticket header. Also typing same coupon number should not create additional orders because Coupon Redeem Status is <code>In Ticket</code>. When you click on order line you shouldn’t see <code>Gift</code> and <code>Void</code> buttons. 
</p>

<p>
User can submit this order or cancel it by clicking on order line and clicking Cancel. We permit that because we give a chance to customer to change her mind before submitting ticket. Maybe she thought this is a free Breakfast coupon :) 
</p>

<p>
On next step we’ll handle both cases. Cancel this order now and change Coupon Redeem Status by editing Coupon entity and changing Redeemed Field value to No.
</p>

</div>

<h2 class="sectionedit7" id="canceling_and_submitting_promotion_orders">Canceling and Submitting Promotion Orders</h2>
<div class="level2">

<p>
To be able to understand an order line is cancelled before submitted to kitchen we’ll handle <code>Order Cancelled</code> event.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons28c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons28.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons28c4f0.jpg_%3b?w=700&amp;tok=74935f" class="media" alt="" width="700" /></a>
</p>

<p>
We’ll check if a coupon number attached to order that is being cancelled. We can use <code>{ORDER STATE:Coupon Number}</code> tag to read assigned Coupon Number to the order. If it is not null we can update Redeem Status of the Coupon to No. So we can use that coupon again later. 
</p>

<p>
Now we’ll Change Redeem Status of Coupon to Yes when order submitted. We’ll create another rule for <code>Order State Updated</code> event. 
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons29c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons29.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons29ef04.jpg?w=700&amp;tok=6de1b3" class="media" alt="" width="700" /></a>
</p>

<p>
Like we did on previous rule we’ll check if there is a coupon number attached to the order and new state of the order is <code>Submitted</code>. If so we’ll update Coupon as Redeemed by changing Redeemed field value to <code>Yes</code> and this coupon can’t be used again.
</p>

<p>
Now test how it works. Scan a coupon number, scan it again, cancel it, scan it again and submit it. Create a new ticket and scan it again. It should work fine for all cases. 
</p>

<p>
Our Coupon Management Infrastructure is almost ready. You’ll notice SambaPOS generates no response when Coupon is already redeemed or scanned. On last step we’ll generate messages to inform operator. 
</p>

</div>

<h2 class="sectionedit8" id="creating_operator_feedbacks">Creating Operator Feedbacks</h2>
<div class="level2">

<p>
We’ll show a message to let operator understand why coupon code is not working. Let&#039;s create a “Show Message” action. 
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons30c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons30.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons30dfaf.jpg_%3b?w=700&amp;tok=63c192" class="media" alt="" width="700" /></a>
</p>

<p>
When we call this action it displays a modal message to user. We’ll set message text from rule so we’ll configure Message parameter as a variable. [:Message] syntax creates a new value named as message. 
</p>

<p>
Now we’ll create another rule to check Coupon Status and display a message if it is already scanned. We’ll use “Ticket Entity Changed” rule for this. 
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons31c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons31.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons31d6b0.jpg_%3b?w=700&amp;tok=05c42d" class="media" alt="" width="700" /></a>
</p>

<p>
When Loaded coupon Redeem Status is <code>In Ticket</code> we’ll display a message. Before displaying the message we’ll also remove coupon from ticket header. 
</p>

<p>
We need another rule to test if Coupon is already Redeemed. I’ll clone this rule and change related values.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons32c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons32.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons3289ce.jpg_%3b?w=700&amp;tok=6e5440" class="media" alt="" width="700" /></a>
</p>

<p>
On Custom Constraints section we’re checking if selected entity is a Coupon and if yes we’re checking it’s status. If it is <code>Yes</code> we’ll display a message to warn user. 
</p>

<p>
Now test it to see how it works. Since our previous coupon is already redeemed change it’s Redeemed value to No or create another one by selling a coupon. 
</p>

<p>
You can test these cases:
</p>
<ol>
<li class="level1"><div class="li"> When we double scan a coupon code in a ticket we should see “Coupon already scanned” message.</div>
</li>
<li class="level1"><div class="li"> When we submit a coupon and scan it again it should display “Coupon already redeemed” message.</div>
</li>
</ol>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons33c5dc.html?id=en%3Aredeeming_coupons" class="media" title="en:promotions:coupons33.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons3324ec.jpg_%3b?w=700&amp;tok=bf739d" class="media" alt="" width="700" /></a>
</p>

<p>
Our Coupon Management System is ready. Now we can sell and give free items with coupons. 
</p>
<ul>
<li class="level1"><div class="li"> Back to <a href="promotion_coupons_documentation.html" class="wikilink1" title="en:promotion_coupons_documentation">Promotion Coupons Documentation</a></div>
</li>
<li class="level1"><div class="li"> Next Topic &gt; <a href="printing_coupons.html" class="wikilink1" title="en:printing_coupons">Printing Coupons</a></div>
</li>
</ul>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>en/redeeming_coupons.txt</bdi> · Last modified: 2013/09/16 04:47 (external edit)</div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li class="source"><a href="redeeming_coupons39b4.html?do=edit" title="Show pagesource [v]" rel="nofollow" accesskey="v"><span>Show pagesource</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13 9h5.5L13 3.5V9M6 2h8l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4c0-1.11.89-2 2-2m.12 13.5l3.74 3.74 1.42-1.41-2.33-2.33 2.33-2.33-1.42-1.41-3.74 3.74m11.16 0l-3.74-3.74-1.42 1.41 2.33 2.33-2.33 2.33 1.42 1.41 3.74-3.74z"/></svg></a></li><li class="revs"><a href="redeeming_coupons5f35.html?do=revisions" title="Old revisions [o]" rel="nofollow" accesskey="o"><span>Old revisions</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11 7v5.11l4.71 2.79.79-1.28-4-2.37V7m0-5C8.97 2 5.91 3.92 4.27 6.77L2 4.5V11h6.5L5.75 8.25C6.96 5.73 9.5 4 12.5 4a7.5 7.5 0 0 1 7.5 7.5 7.5 7.5 0 0 1-7.5 7.5c-3.27 0-6.03-2.09-7.06-5h-2.1c1.1 4.03 4.77 7 9.16 7 5.24 0 9.5-4.25 9.5-9.5A9.5 9.5 0 0 0 12.5 2z"/></svg></a></li><li class="backlink"><a href="redeeming_coupons2271.html?do=backlink" title="Backlinks" rel="nofollow"><span>Backlinks</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10.59 13.41c.41.39.41 1.03 0 1.42-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l3.54-3.54a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.49 1.49c.01-.82-.12-1.64-.4-2.42l.47-.48a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-3.53 3.53a2.982 2.982 0 0 0 0 4.24m2.82-4.24c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-3.54 3.54a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.49-1.49c-.01.82.12 1.64.4 2.43l-.47.47a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l3.53-3.53a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42z"/></svg></a></li><li class="top"><a href="#dokuwiki__top" title="Back to top [t]" rel="nofollow" accesskey="t"><span>Back to top</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license" class="urlextern">CC Attribution-Share Alike 4.0 International</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license"><img src="../../lib/images/license/button/cc-by-sa.png" alt="CC Attribution-Share Alike 4.0 International" /></a>        <a href="https://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/dokuwiki/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="https://php.net/" title="Powered by PHP" ><img
            src="../../lib/tpl/dokuwiki/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/dokuwiki/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../../lib/tpl/dokuwiki/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="https://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/dokuwiki/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="https://sambapos.org/wiki/lib/exe/indexer.php?id=en%3Aredeeming_coupons&amp;1547095231" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div></body>

<!-- Mirrored from sambapos.org/wiki/doku.php/en/redeeming_coupons by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 10 Jan 2019 04:46:23 GMT -->
</html>

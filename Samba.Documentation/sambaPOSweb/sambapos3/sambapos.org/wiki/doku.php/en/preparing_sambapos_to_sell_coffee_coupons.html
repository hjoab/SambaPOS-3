<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">

<!-- Mirrored from sambapos.org/wiki/doku.php/en/preparing_sambapos_to_sell_coffee_coupons by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 10 Jan 2019 04:44:55 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <title>Preparing SambaPOS to Sell Coffee Coupons [SambaPOS V3]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="theme-color" content="#008800"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="en,preparing_sambapos_to_sell_coffee_coupons"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://sambapos.org/wiki/lib/exe/opensearch.php" title="SambaPOS V3"/>
<link rel="start" href="https://sambapos.org/wiki/"/>
<link rel="contents" href="preparing_sambapos_to_sell_coffee_couponsdecf?do=index" title="Sitemap"/>
<link rel="manifest" href="https://sambapos.org/wiki/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="https://sambapos.org/wiki/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="https://sambapos.org/wiki/feed.php?mode=list&amp;ns=en"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="preparing_sambapos_to_sell_coffee_coupons47cd.html?do=export_xhtml"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="preparing_sambapos_to_sell_coffee_couponsf7dc.txt?do=export_raw"/>
<link rel="canonical" href="preparing_sambapos_to_sell_coffee_coupons.html"/>
<link rel="stylesheet" type="text/css" href="https://sambapos.org/wiki/lib/exe/css.php?t=dokuwiki&amp;tseed=c8874b19d6985f85f27e1d0baa627941"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='en';var JSINFO = {"plugin_aceeditor":{"default":1,"highlight":1,"wraplimit":80,"colortheme":"textmate","latex":1,"markdown":1,"mdpage":false,"xmltags":[]},"ga":{"trackingId":"UA-2397752-18","anonymizeIp":true,"action":"show","trackOutboundLinks":false,"options":[],"pageview":"\/wiki\/en\/preparing_sambapos_to_sell_coffee_coupons"},"id":"en:preparing_sambapos_to_sell_coffee_coupons","namespace":"en","ACT":"show","useHeadingNavigation":1,"useHeadingContent":1};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="https://sambapos.org/wiki/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="https://sambapos.org/wiki/lib/exe/js.php?t=dokuwiki&amp;tseed=c8874b19d6985f85f27e1d0baa627941&amp;lang=en"></script>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="https://sambapos.org/wiki/lib/tpl/dokuwiki/images/favicon.ico" />
<link rel="apple-touch-icon" href="../../lib/tpl/dokuwiki/images/apple-touch-icon.png" />
    </head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_dokuwiki    showSidebar hasSidebar">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="https://sambapos.org/wiki/doku.php/p"  accesskey="h" title="[H]"><img src="../../lib/exe/fetch.php/wiki/logo.png_%3b" width="70" height="70" alt="" /> <span>SambaPOS V3</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li class="action login"><a href="preparing_sambapos_to_sell_coffee_coupons51ef.html?do=login&amp;sectok=" title="Log In" rel="nofollow"><span>Log In</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10 17.25V14H3v-4h7V6.75L15.25 12 10 17.25M8 2h9a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-4h2v4h9V4H8v4H6V4a2 2 0 0 1 2-2z"/></svg></a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="https://sambapos.org/wiki/doku.php/p" method="get" role="search" class="search doku_form" id="dw__search" accept-charset="utf-8"><input type="hidden" name="do" value="search" /><input type="hidden" name="id" value="en:preparing_sambapos_to_sell_coffee_coupons" /><div class="no"><input name="q" type="text" class="edit" title="[F]" accesskey="f" placeholder="Search" autocomplete="on" id="qsearch__in" value="" /><button value="1" type="submit" title="Search">Search</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="https://sambapos.org/wiki/doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="en:preparing_sambapos_to_sell_coffee_coupons" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Show pagesource</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent Changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Log In</option></optgroup></select><button type="submit">&gt;</button></div></form>            </div>
            <ul>
                <li class="action recent"><a href="preparing_sambapos_to_sell_coffee_coupons810b.html?do=recent" title="Recent Changes [r]" rel="nofollow" accesskey="r">Recent Changes</a></li><li class="action media"><a href="preparing_sambapos_to_sell_coffee_couponsb4e1.html?do=media&amp;ns=en" title="Media Manager" rel="nofollow">Media Manager</a></li><li class="action index"><a href="preparing_sambapos_to_sell_coffee_couponsdecf?do=index" title="Sitemap [x]" rel="nofollow" accesskey="x">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                                        <div class="trace"><span class="bchead">Trace:</span> <span class="bcsep">•</span> <bdi><a href="how_to_help_translation.html"  class="breadcrumbs" title="en:how_to_help_translation">How to help translation</a></bdi> <span class="bcsep">•</span> <bdi><a href="installing_sql_express_2012_for_sambapos_v3.html"  class="breadcrumbs" title="en:installing_sql_express_2012_for_sambapos_v3">Installing SQL Express 2012 for SambaPOS V3</a></bdi> <span class="bcsep">•</span> <bdi><a href="tips_tricks_for_new_users.html"  class="breadcrumbs" title="en:tips_tricks_for_new_users">Tips &amp; Tricks for new users.</a></bdi> <span class="bcsep">•</span> <bdi><a href="auto_rounding.html"  class="breadcrumbs" title="en:auto_rounding">Auto Rounding</a></bdi> <span class="bcsep">•</span> <bdi><a href="barcode_printing_tags.html"  class="breadcrumbs" title="en:barcode_printing_tags">Barcode Printing Tags</a></bdi> <span class="bcsep">•</span> <bdi><a href="random_number_generator_tag.html"  class="breadcrumbs" title="en:random_number_generator_tag">Random Number Generator Tags</a></bdi> <span class="bcsep">•</span> <bdi><a href="primary_field_editing_formats.html"  class="breadcrumbs" title="en:primary_field_editing_formats">Primary Field Editing Formats</a></bdi> <span class="bcsep">•</span> <bdi><a href="task_widget.html"  class="breadcrumbs" title="en:task_widget">Task Widget</a></bdi> <span class="bcsep">•</span> <bdi><a href="modify_variable_action.html"  class="breadcrumbs" title="en:modify_variable_action">Modify Variable Action</a></bdi> <span class="bcsep">•</span> <span class="curid"><bdi><a href="preparing_sambapos_to_sell_coffee_coupons.html"  class="breadcrumbs" title="en:preparing_sambapos_to_sell_coffee_coupons">Preparing SambaPOS to Sell Coffee Coupons</a></bdi></span></div>
                    </div>
    


    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

                            <!-- ********** ASIDE ********** -->
                <div id="dokuwiki__aside"><div class="pad aside include group">
                    <h3 class="toggle">Sidebar</h3>
                    <div class="content"><div class="group">
                                                Languages:
<div class="plugin_translation"><form action="https://sambapos.org/wiki/doku.php/p" id="translation__dropdown"><select name="id" class="wikilink1"><option class="wikilink1 cur" title="English" value="en/preparing_sambapos_to_sell_coffee_coupons" selected="selected">en</option><option class="wikilink2" title="Türkçe" value="tr/preparing_sambapos_to_sell_coffee_coupons">tr</option></select><input name="go" type="submit" value="&rarr;" /></form></div>                        
<p>
<strong>Languages:</strong>
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://sambapos.org/wiki/doku.php/tr/p" class="urlextern" title="http://sambapos.org/wiki/doku.php/tr/p" rel="nofollow">Turkish</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://sambapos.org/wiki/doku.php/p?id=en/p" class="urlextern" title="http://sambapos.org/wiki/doku.php/p?id=en/p" rel="nofollow">English</a></div>
</li>
</ul>

<p>
<strong>Links - SambaPOS V4</strong>
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://www.sambapos.com/" class="urlextern" title="http://www.sambapos.com" rel="nofollow">SambaPOS V4 WebSite</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://dorum.sambapos.org/" class="urlextern" title="http://dorum.sambapos.org" rel="nofollow">SambaPOS V4 Forum</a></div>
</li>
</ul>

<p>
<strong>Links</strong>
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://www.sambapos.org/" class="urlextern" title="http://www.sambapos.org" rel="nofollow">SambaPOS Web Site</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.sambapos.org/" class="urlextern" title="http://www.sambapos.org" rel="nofollow">Forum</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.sambapos.org/en/downloads" class="urlextern" title="http://www.sambapos.org/en/downloads" rel="nofollow">Download</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.sambapos.org/wiki" class="urlextern" title="http://www.sambapos.org/wiki" rel="nofollow">Documantation</a></div>
</li>
</ul>

<p>
<strong>Links - SambaPOS V2</strong>
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://v2.sambapos.org/" class="urlextern" title="http://v2.sambapos.org" rel="nofollow">SambaPOS V2 WebSite</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://forum2.sambapos.org/" class="urlextern" title="http://forum2.sambapos.org" rel="nofollow">Forum</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://sambapos.googlecode.com/" class="urlextern" title="http://sambapos.googlecode.com" rel="nofollow">Download</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://doc.sambapos.org/" class="urlextern" title="http://doc.sambapos.org" rel="nofollow">Dökümantasyon</a></div>
</li>
</ul>

<p>
<strong>Links - Social Media</strong>
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://www.facebook.com/sambapos" class="urlextern" title="http://www.facebook.com/sambapos" rel="nofollow">Facebook</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://www.twitter.com/sambapos" class="urlextern" title="https://www.twitter.com/sambapos" rel="nofollow">Twitter</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.youtube.com/user/sambapos" class="urlextern" title="http://www.youtube.com/user/sambapos" rel="nofollow">Youtube</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://vimeo.com/sambapos" class="urlextern" title="http://vimeo.com/sambapos" rel="nofollow">Vimeo</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.pinterest.com/sambapos" class="urlextern" title="http://www.pinterest.com/sambapos" rel="nofollow">Pinterest</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.flickr.com/photos/sambapos" class="urlextern" title="http://www.flickr.com/photos/sambapos" rel="nofollow">Flickr</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://instagram.com/sambapos" class="urlextern" title="http://instagram.com/sambapos" rel="nofollow">Instagram</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://sambapos.tumblr.com/" class="urlextern" title="http://sambapos.tumblr.com" rel="nofollow">Tumblr</a></div>
</li>
</ul>

<p>
—-
</p>
                                            </div></div>
                </div></div><!-- /aside -->
            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span>en:preparing_sambapos_to_sell_coffee_coupons</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#preparing_sambapos_to_sell_coffee_coupons">Preparing SambaPOS to Sell Coffee Coupons</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#creating_coupon_entity">Creating Coupon Entity</a></div></li>
<li class="level2"><div class="li"><a href="#adding_actions_to_update_field_values">Adding Actions to Update Field Values</a></div></li>
<li class="level2"><div class="li"><a href="#creating_coffee_coupon_product">Creating Coffee Coupon Product</a></div></li>
<li class="level2"><div class="li"><a href="#updating_coffee_coupon_order_state">Updating Coffee Coupon Order State</a></div></li>
<li class="level2"><div class="li"><a href="#updating_coffee_coupon_menu_item">Updating Coffee Coupon Menu Item</a></div></li>
<li class="level2"><div class="li"><a href="#adding_create_coupon_action">Adding Create Coupon Action</a></div></li>
<li class="level2"><div class="li"><a href="#adding_coffee_coupon_order_handling_rules">Adding Coffee Coupon Order Handling Rules</a></div></li>
<li class="level2"><div class="li"><a href="#handling_payment_to_update_order_states">Handling Payment to update Order states</a></div></li>
<li class="level2"><div class="li"><a href="#creating_coupons">Creating Coupons</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="preparing_sambapos_to_sell_coffee_coupons">Preparing SambaPOS to Sell Coffee Coupons</h1>
<div class="level1">

<p>
Promotion Coupon is an entity that we use to enter free items to tickets. This is a well formatted random number. We can print this number as a barcode or QR Tag. When this number is scanned on a SambaPOS terminal it will add related product into the ticket as a gift product. When redeemed we’ll update coupon status so it can’t be used multiple times. 
</p>

<p>
After finishing this chapter you can create coupons and sell them through a ticket. For example you can sell 100 coffee coupons with a discounted price. That can be a company that wishes to give coffee coupons to  their personnel. 
</p>

</div>

<h2 class="sectionedit2" id="creating_coupon_entity">Creating Coupon Entity</h2>
<div class="level2">

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons2cb0e.html?id=en%3Apreparing_sambapos_to_sell_coffee_coupons" class="media" title="en:promotions:coupons2.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons2fede.jpg_%3b?w=700&amp;tok=0344f3" class="media" alt="" width="700" /></a>
</p>

<p>
We’ll create new Entity Type for Coupons. When a new coupon created we’ll store it as a new entity. Primary field of coupon entity is Coupon Number. This number will be a 9 digit number. Eight digits are random generated numbers and ninth digit is check digit to validate number. It starts with CP prefix so we can understand entered random number is a Coupon Number. As a result Coupon Numbers becomes 11 digit numbers. For easy editing we’ll split this number with minus characters. On Primary Field Format C is a place holder for a single character. Define length and editing format as CCCCC-CCC-CCC. Read <a href="primary_field_editing_formats.html" class="wikilink1" title="en:primary_field_editing_formats">Primary Field Editing Formats</a> document for more info.
</p>

<p>
We’ll create some custom fields for coupons. 
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons3cb0e.html?id=en%3Apreparing_sambapos_to_sell_coffee_coupons" class="media" title="en:promotions:coupons3.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons36b61.jpg_%3b?w=700&amp;tok=1b43fc" class="media" alt="" width="700" /></a>
</p>

<p>
We have three custom fields. 
</p>
<ol>
<li class="level1"><div class="li"><strong>Menu Item Name:</strong> This field used to assign Coupon to a Menu Item. So when redeemed the menu item typed there will be added as a gift. Instead of assigning coupons to a single menu item we created a field for more flexibility in case of we want to create coupons for other menu items.</div>
</li>
<li class="level1"><div class="li"><strong>Redeemed:</strong> We’ll track status of coupon under this field. It have three values. New created Coupons will have “No” value. When we use coupon in a ticket it will be “In Ticket” and when ticket submitted value becomes “Yes”. When value is “Yes” it means this coupon used and can’t used again. </div>
</li>
<li class="level1"><div class="li"><strong>Expiration Date:</strong> We can set an expiration date for coupons so it can’t be used after expiration date.</div>
</li>
</ol>

</div>

<h2 class="sectionedit3" id="adding_actions_to_update_field_values">Adding Actions to Update Field Values</h2>
<div class="level2">

<p>
We’ll need actions to update Coupon custom fields. For example we have to change Redeemed value to “Yes” when coupon is used in a ticket. Let’s create a new action to update Coupon Menu Item Name.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons4cb0e.html?id=en%3Apreparing_sambapos_to_sell_coffee_coupons" class="media" title="en:promotions:coupons4.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons4ce67.jpg_%3b?w=700&amp;tok=1252b6" class="media" alt="" width="700" /></a>
</p>

<p>
Action Name will be <code>Update Coupon Menu Item Name</code> and Action Type will be <code>Update Entity Data</code>. We’ll set Entity Type Name as <code>Coupons</code> so this action updates Coupons. Field Name will be <code>Menu Item Name</code> since we store menu item names under this field. We’ll send Coupon Number and Menu Item Name values from calling rule for this reason we’ll configure these parameters as variables.
</p>

<p>
We need another action to update Coupon Redeem Status. Let&#039;s clone a new action from previous one. 
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons5cb0e.html?id=en%3Apreparing_sambapos_to_sell_coffee_coupons" class="media" title="en:promotions:coupons5.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons505ae.jpg_%3b?w=700&amp;tok=cf1d86" class="media" alt="" width="700" /></a>
</p>

<p>
Change action name to <code>Update Coupon Status</code> and Field Name as <code>Redeemed</code>. We’ll use this action when we create new coupons and when we need to disable them. 
</p>

</div>

<h2 class="sectionedit4" id="creating_coffee_coupon_product">Creating Coffee Coupon Product</h2>
<div class="level2">

<p>
Until this step we created Coupon Entity Type, needed custom fields and two actions to update these custom fields. Now we’ll need a product called “Coffee Coupon” to sell Coffee Coupons. 
</p>
<ol>
<li class="level1"><div class="li">Create a new menu category called “Coupons”.</div>
</li>
<li class="level1"><div class="li">Create “Coffee Coupon” product. Group Code is “Coupons” and Tag it as Coffee to relate it with Coffee Product. Enter desired price for the coupon and add it to Coupons Category.</div>
</li>
</ol>

<p>
You should have something like this.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons6cb0e.html?id=en%3Apreparing_sambapos_to_sell_coffee_coupons" class="media" title="en:promotions:coupons6.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons6b5b5.jpg_%3b?w=700&amp;tok=4c22c4" class="media" alt="" width="700" /></a>
</p>

<p>
You can add more coupon products under this category. Coffee price is $1.45 on my sample data so I’ve priced Coffee Coupon as $1.45 to match it to Coffee price. 
</p>

</div>

<h2 class="sectionedit5" id="updating_coffee_coupon_order_state">Updating Coffee Coupon Order State</h2>
<div class="level2">

<p>
So when we sell <code>Coffee Coupon</code> we’ll create a new Coupon entity. For this reason we need to handle <code>Order Added</code> event to understand if Coffee Coupon is added to ticket. However we need to solve an issue here. We can’t create coupon entity as soon as <code>Coffee Coupon</code> product added to ticket because user can cancel it after printing Coupon to generate free coupons. We need to create coupons when ticket gets paid. We can use <code>Order Status</code> feature to determine if Coffee Coupon Product is paid or not. When we first add Coupon Product we’ll change order state to <code>Coupon Ordered</code> and when Ticket Paid we’ll change it to <code>Coupon Paid</code>. SambaPOS generates additional events when an order status is changed so we can understand Coupon is paid. Let’s create needed actions to update order states.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons7cb0e.html?id=en%3Apreparing_sambapos_to_sell_coffee_coupons" class="media" title="en:promotions:coupons7.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons724b5.jpg_%3b?w=700&amp;tok=9ecc9d" class="media" alt="" width="700" /></a>
</p>

<p>
When we add a <code>Coffee Coupon</code> product to a ticket default order state will be <code>Coupon Ordered</code>. When ticket paid it becomes <code>Coupon Paid</code>. We’ll handle the moment order status changes to <code>Coupon Paid</code> from <code>Coupon Ordered</code> to create coupons. Group order and State order values are useful to sort state values while displaying multiple orders.
</p>

</div>

<h2 class="sectionedit6" id="updating_coffee_coupon_menu_item">Updating Coffee Coupon Menu Item</h2>
<div class="level2">

<p>
You&#039;ll remember Coupon entity has a field called <code>Menu Item Name</code>. We use this field to map coupons to Menu Items. So while creating a coupon we need to update <code>Menu Item Name</code> value. Instead of directly mapping Coffee Coupons to Coupon entities we’ll create additional Order State to store Menu Item Name. It will give more flexibility when you need to create coupons for different products. 
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons8cb0e.html?id=en%3Apreparing_sambapos_to_sell_coffee_coupons" class="media" title="en:promotions:coupons8.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons88452.jpg_%3b?w=700&amp;tok=38450e" class="media" alt="" width="700" /></a>
</p>

<p>
Now we have another order state called <code>Coupon Product</code>. We don’t need to know previous state value so we’ll leave Current State parameter empty. Group and State Order values are 5 since we want to display this value at the end. 
</p>

<p>
As a result Coupon Order Lines stores two additional data.
</p>
<ol>
<li class="level1"><div class="li"> <strong>Coupon Order State:</strong> It will be <code>Coupon Ordered</code> when coupon product first added and <code>Coupon Paid</code> when ticket paid.</div>
</li>
<li class="level1"><div class="li"> <strong>Menu Item Name of the coupon:</strong> We’ll use this value update menu item name of the coupon entity while creating coupons. </div>
</li>
</ol>

</div>

<h2 class="sectionedit7" id="adding_create_coupon_action">Adding Create Coupon Action</h2>
<div class="level2">

<p>
Another action we need is <code>Create Coupon</code> action. When we call it creates a new Coupon Entity named with a Random Number.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons9cb0e.html?id=en%3Apreparing_sambapos_to_sell_coffee_coupons" class="media" title="en:promotions:coupons9.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons9722b.jpg_%3b?w=700&amp;tok=a35c3d" class="media" alt="" width="700" /></a>
</p>

<p>
Entity Type Name is <code>Coupons</code> since we need to create a coupon entity. Entity name should be <code>CP{RANDOMC:8}</code>. {RANDOMC:8} tag is a <a href="random_number_generator_tag.html" class="wikilink1" title="en:random_number_generator_tag">Random Number Generator Tag</a> that generates a 8 digit random number with check digit. So it becomes 9 digits. We also want to prefix Coupon Numbers with CP letters to be able to understand this random number is a coupon number. Finally Custom Data field contains <code>Redeemed=No</code> value to define default Redeemed field value.
</p>

<p>
We’re ready to create rules that creates Coupons when <code>Coffee Coupon Product</code> sold.
</p>

</div>

<h2 class="sectionedit8" id="adding_coffee_coupon_order_handling_rules">Adding Coffee Coupon Order Handling Rules</h2>
<div class="level2">

<p>
When we first add Coffee Coupon order in a ticket its order state should be Coupon Ordered. We’ll create a rule to configure this.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons10cb0e.html?id=en%3Apreparing_sambapos_to_sell_coffee_coupons" class="media" title="en:promotions:coupons10.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons10b143.jpg_%3b?w=700&amp;tok=8bb729" class="media" alt="" width="700" /></a>
</p>

<p>
We’ll handle <code>Order Added to Ticket</code> event and execute this rule if Menu Item Group Code Equals to <code>Coupons</code> value. If you didn’t do so change <code>Coffee Coupon</code> product’s Group Code to <code>Coupons</code> so this rule will handle it. New coupons under this product group will just work without changes.
</p>

<p>
When it detects a Coupon it executes two actions.
</p>
<ol>
<li class="level1"><div class="li"> Calls <code>Update Coupon Product Order State</code> action to update order state as <code>Coupon Ordered</code>.</div>
</li>
<li class="level1"><div class="li"> Calls <code>Update Coupon Product Menu Item Name</code> action to send Coupon Product Tag value to Order State as the Coupon Menu Item Name.</div>
</li>
</ol>
<div class="wrap_center wrap_round wrap_tip plugin_wrap" style="width: 60%;">
<p>
Don’t forget adding a map to rules to enable them. If there is no mapping they won’t work and listed as gray color. For the simplicity of this documentation we won&#039;t mention it anymore but all rules needs a mapping.
</p>
</div>
<p>
As a result of this configuration order state values should update correctly when we add a Coffee Coupon product into a ticket. 
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons11cb0e.html?id=en%3Apreparing_sambapos_to_sell_coffee_coupons" class="media" title="en:promotions:coupons11.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons1178cb.jpg_%3b?w=700&amp;tok=04c0df" class="media" alt="" width="700" /></a>
</p>

<p>
Coupon Ordered and Coffee values displays correctly. Now we know this order should generate a coupon, not paid yet and generates a coupon for Coffee.
</p>

<p>
When we full settle the ticket <code>Coupon Ordered</code> value should change to <code>Coupon Paid</code>. Now we’ll handle <code>Ticket Close</code> event to check if ticket is paid. In fact there is already a rule for this named as “Ticket Payment Check” but for this tutorial we’ll create new Rule. 
</p>

</div>

<h2 class="sectionedit11" id="handling_payment_to_update_order_states">Handling Payment to update Order states</h2>
<div class="level2">

<p>
We’ll create a new rule for <code>Before Ticket Closing</code> event to check if ticket is paid or not. 
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons12cb0e.html?id=en%3Apreparing_sambapos_to_sell_coffee_coupons" class="media" title="en:promotions:coupons12.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons1245be.jpg_%3b?w=700&amp;tok=ee9854" class="media" alt="" width="700" /></a>
</p>

<p>
While closing the ticket if <code>Remaining Amount</code> is 0 we’ll update order states to <code>Coupon Paid</code> where order state equals to <code>Coupon Ordered</code>.
</p>

<p>
So create a new ticket now, add Coffee Coupon product and settle that ticket. When you open this ticket from ticket explorer, Order State of the Coffee Coupon product should be “Coupon Paid”. 
</p>

<p>
Our customer bought a Breakfast, one coffee and a coffee coupon. As you can see order state changed to <code>Coupon Paid</code>. Other order states didn’t changed since we set the <code>Current State</code> for the action. It only changed for orders that already have “Coupon Ordered” state.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons13cb0e.html?id=en%3Apreparing_sambapos_to_sell_coffee_coupons" class="media" title="en:promotions:coupons13.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons13aae7.jpg_%3b?w=700&amp;tok=66300e" class="media" alt="" width="700" /></a>
</p>

<p>
Getting state handling in SambaPOS is important to create a flawless workflow for your business. Feel free to ask any questions on our forums so we can update our documentation to give more details about them.
</p>

</div>

<h2 class="sectionedit12" id="creating_coupons">Creating Coupons</h2>
<div class="level2">

<p>
As the order state changes from <code>Coupon Ordered</code> to <code>Coupon Paid</code> we’ll create the Coupon Entity. To be able to handle it we’ll create a rule for <code>Order State Updated</code> event.
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons14cb0e.html?id=en%3Apreparing_sambapos_to_sell_coffee_coupons" class="media" title="en:promotions:coupons14.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons14afb5.jpg_%3b?w=700&amp;tok=1b87aa" class="media" alt="" width="700" /></a>
</p>

<p>
I’ve created two constraints to determine ordered Coupon is paid. If constraints are true it executes <code>Create Coupon</code> action to create a coupon entity. After creating that it executes second action to update coupon’s menu item name. As you have noticed I’m reading <code>Menu Item Name</code> from Order State by using <code>{ORDER STATE:X}</code> tag. You’ll remember we are using same tag in printer templates to print order states. 
</p>

<p>
To test this rule sell another Coffee Coupon and check if a Coupon Entity created or not. 
</p>

<p>
<a href="../../lib/exe/detail.php/en/promotions/coupons15cb0e.html?id=en%3Apreparing_sambapos_to_sell_coffee_coupons" class="media" title="en:promotions:coupons15.jpg"><img src="../../lib/exe/fetch.php/en/promotions/coupons1520eb.jpg_%3b?w=700&amp;tok=3fe80d" class="media" alt="" width="700" /></a>
</p>

<p>
This is what SambaPOS generated for me. Coupon Number, Redeemed value and Menu Item Name all correctly updated. Expiration date is empty so this coupon never expires. We’ll handle expiration topic on further documentation.
</p>
<ul>
<li class="level1"><div class="li"> Back to <a href="promotion_coupons_documentation.html" class="wikilink1" title="en:promotion_coupons_documentation">Promotion Coupons Documentation</a></div>
</li>
<li class="level1"><div class="li"> Next Topic &gt; <a href="redeeming_coupons.html" class="wikilink1" title="en:redeeming_coupons">Redeeming Coupons</a></div>
</li>
</ul>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>en/preparing_sambapos_to_sell_coffee_coupons.txt</bdi> · Last modified: 2013/09/16 11:45 (external edit)</div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li class="source"><a href="preparing_sambapos_to_sell_coffee_coupons39b4.html?do=edit" title="Show pagesource [v]" rel="nofollow" accesskey="v"><span>Show pagesource</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13 9h5.5L13 3.5V9M6 2h8l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4c0-1.11.89-2 2-2m.12 13.5l3.74 3.74 1.42-1.41-2.33-2.33 2.33-2.33-1.42-1.41-3.74 3.74m11.16 0l-3.74-3.74-1.42 1.41 2.33 2.33-2.33 2.33 1.42 1.41 3.74-3.74z"/></svg></a></li><li class="revs"><a href="preparing_sambapos_to_sell_coffee_coupons5f35.html?do=revisions" title="Old revisions [o]" rel="nofollow" accesskey="o"><span>Old revisions</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11 7v5.11l4.71 2.79.79-1.28-4-2.37V7m0-5C8.97 2 5.91 3.92 4.27 6.77L2 4.5V11h6.5L5.75 8.25C6.96 5.73 9.5 4 12.5 4a7.5 7.5 0 0 1 7.5 7.5 7.5 7.5 0 0 1-7.5 7.5c-3.27 0-6.03-2.09-7.06-5h-2.1c1.1 4.03 4.77 7 9.16 7 5.24 0 9.5-4.25 9.5-9.5A9.5 9.5 0 0 0 12.5 2z"/></svg></a></li><li class="backlink"><a href="preparing_sambapos_to_sell_coffee_coupons2271.html?do=backlink" title="Backlinks" rel="nofollow"><span>Backlinks</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10.59 13.41c.41.39.41 1.03 0 1.42-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l3.54-3.54a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.49 1.49c.01-.82-.12-1.64-.4-2.42l.47-.48a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-3.53 3.53a2.982 2.982 0 0 0 0 4.24m2.82-4.24c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-3.54 3.54a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.49-1.49c-.01.82.12 1.64.4 2.43l-.47.47a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l3.53-3.53a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42z"/></svg></a></li><li class="top"><a href="#dokuwiki__top" title="Back to top [t]" rel="nofollow" accesskey="t"><span>Back to top</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license" class="urlextern">CC Attribution-Share Alike 4.0 International</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license"><img src="../../lib/images/license/button/cc-by-sa.png" alt="CC Attribution-Share Alike 4.0 International" /></a>        <a href="https://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/dokuwiki/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="https://php.net/" title="Powered by PHP" ><img
            src="../../lib/tpl/dokuwiki/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/dokuwiki/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../../lib/tpl/dokuwiki/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="https://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/dokuwiki/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="https://sambapos.org/wiki/lib/exe/indexer.php?id=en%3Apreparing_sambapos_to_sell_coffee_coupons&amp;1547095231" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div></body>

<!-- Mirrored from sambapos.org/wiki/doku.php/en/preparing_sambapos_to_sell_coffee_coupons by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 10 Jan 2019 04:45:35 GMT -->
</html>

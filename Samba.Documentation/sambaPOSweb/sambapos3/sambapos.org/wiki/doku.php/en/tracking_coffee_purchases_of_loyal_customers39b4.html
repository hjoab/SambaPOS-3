<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">

<!-- Mirrored from sambapos.org/wiki/doku.php/en/tracking_coffee_purchases_of_loyal_customers?do=edit by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 10 Jan 2019 04:52:44 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <title>Tracking Coffee Purchases of Loyal Customers [SambaPOS V3]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="theme-color" content="#008800"/>
<meta name="robots" content="noindex,nofollow"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://sambapos.org/wiki/lib/exe/opensearch.php" title="SambaPOS V3"/>
<link rel="start" href="https://sambapos.org/wiki/"/>
<link rel="contents" href="https://sambapos.org/wiki/doku.php/en/tracking_coffee_purchases_of_loyal_customers?do=index" title="Sitemap"/>
<link rel="manifest" href="https://sambapos.org/wiki/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="https://sambapos.org/wiki/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="https://sambapos.org/wiki/feed.php?mode=list&amp;ns=en"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="https://sambapos.org/wiki/doku.php/en/tracking_coffee_purchases_of_loyal_customers?do=export_xhtml"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="https://sambapos.org/wiki/doku.php/en/tracking_coffee_purchases_of_loyal_customers?do=export_raw"/>
<link rel="stylesheet" type="text/css" href="https://sambapos.org/wiki/lib/exe/css.php?t=dokuwiki&amp;tseed=c8874b19d6985f85f27e1d0baa627941"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='en';var JSINFO = {"plugin_aceeditor":{"default":1,"highlight":1,"wraplimit":80,"colortheme":"textmate","latex":1,"markdown":1,"mdpage":false,"xmltags":[]},"ga":{"trackingId":"UA-2397752-18","anonymizeIp":true,"action":"edit","trackOutboundLinks":false,"options":[],"pageview":"\/wiki\/en\/tracking_coffee_purchases_of_loyal_customers"},"id":"en:tracking_coffee_purchases_of_loyal_customers","namespace":"en","ACT":"source","useHeadingNavigation":1,"useHeadingContent":1};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="https://sambapos.org/wiki/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="https://sambapos.org/wiki/lib/exe/js.php?t=dokuwiki&amp;tseed=c8874b19d6985f85f27e1d0baa627941&amp;lang=en"></script>
<script type="text/javascript" charset="utf-8" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
<script type="text/javascript" charset="utf-8">/*<![CDATA[*/$.noConflict();
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="https://sambapos.org/wiki/lib/plugins/aceeditor/build.js"></script>
<script type="text/javascript" charset="utf-8">/*<![CDATA[*/window.require = undefined;
/*!]]>*/</script>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="https://sambapos.org/wiki/lib/tpl/dokuwiki/images/favicon.ico" />
<link rel="apple-touch-icon" href="https://sambapos.org/wiki/lib/tpl/dokuwiki/images/apple-touch-icon.png" />
    </head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_source tpl_dokuwiki     hasSidebar">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="https://sambapos.org/wiki/doku.php/p"  accesskey="h" title="[H]"><img src="https://sambapos.org/wiki/lib/exe/fetch.php/wiki/logo.png" width="70" height="70" alt="" /> <span>SambaPOS V3</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li class="action login"><a href="https://sambapos.org/wiki/doku.php/en/tracking_coffee_purchases_of_loyal_customers?do=login&amp;sectok=" title="Log In" rel="nofollow"><span>Log In</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10 17.25V14H3v-4h7V6.75L15.25 12 10 17.25M8 2h9a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-4h2v4h9V4H8v4H6V4a2 2 0 0 1 2-2z"/></svg></a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="https://sambapos.org/wiki/doku.php/p" method="get" role="search" class="search doku_form" id="dw__search" accept-charset="utf-8"><input type="hidden" name="do" value="search" /><input type="hidden" name="id" value="en:tracking_coffee_purchases_of_loyal_customers" /><div class="no"><input name="q" type="text" class="edit" title="[F]" accesskey="f" placeholder="Search" autocomplete="on" id="qsearch__in" value="" /><button value="1" type="submit" title="Search">Search</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="https://sambapos.org/wiki/doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="en:tracking_coffee_purchases_of_loyal_customers" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="">Show page</option><option value="revisions">Old revisions</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent Changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Log In</option></optgroup></select><button type="submit">&gt;</button></div></form>            </div>
            <ul>
                <li class="action recent"><a href="https://sambapos.org/wiki/doku.php/en/tracking_coffee_purchases_of_loyal_customers?do=recent" title="Recent Changes [r]" rel="nofollow" accesskey="r">Recent Changes</a></li><li class="action media"><a href="https://sambapos.org/wiki/doku.php/en/tracking_coffee_purchases_of_loyal_customers?do=media&amp;ns=en" title="Media Manager" rel="nofollow">Media Manager</a></li><li class="action index"><a href="https://sambapos.org/wiki/doku.php/en/tracking_coffee_purchases_of_loyal_customers?do=index" title="Sitemap [x]" rel="nofollow" accesskey="x">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                                        <div class="trace"><span class="bchead">Trace:</span> <span class="bcsep">•</span> <bdi><a href="https://sambapos.org/wiki/doku.php/en/primary_field_editing_formats"  class="breadcrumbs" title="en:primary_field_editing_formats">Primary Field Editing Formats</a></bdi> <span class="bcsep">•</span> <bdi><a href="https://sambapos.org/wiki/doku.php/en/task_widget"  class="breadcrumbs" title="en:task_widget">Task Widget</a></bdi> <span class="bcsep">•</span> <bdi><a href="https://sambapos.org/wiki/doku.php/en/modify_variable_action"  class="breadcrumbs" title="en:modify_variable_action">Modify Variable Action</a></bdi> <span class="bcsep">•</span> <bdi><a href="https://sambapos.org/wiki/doku.php/en/preparing_sambapos_to_sell_coffee_coupons"  class="breadcrumbs" title="en:preparing_sambapos_to_sell_coffee_coupons">Preparing SambaPOS to Sell Coffee Coupons</a></bdi> <span class="bcsep">•</span> <bdi><a href="https://sambapos.org/wiki/doku.php/en/redeeming_coupons"  class="breadcrumbs" title="en:redeeming_coupons">Redeeming Coupons</a></bdi> <span class="bcsep">•</span> <bdi><a href="https://sambapos.org/wiki/doku.php/en/printing_coupons"  class="breadcrumbs" title="en:printing_coupons">Printing Coupons</a></bdi> <span class="bcsep">•</span> <bdi><a href="https://sambapos.org/wiki/doku.php/en/tracking_coffee_purchases_of_loyal_customers"  class="breadcrumbs" title="en:tracking_coffee_purchases_of_loyal_customers">Tracking Coffee Purchases of Loyal Customers</a></bdi> <span class="bcsep">•</span> <bdi><a href="https://sambapos.org/wiki/doku.php/en/giving_free_coffee"  class="breadcrumbs" title="en:giving_free_coffee">Giving Free Coffee</a></bdi> <span class="bcsep">•</span> <bdi><a href="https://sambapos.org/wiki/doku.php/en/v3.0.28_beta"  class="breadcrumbs" title="en:v3.0.28_beta">V3.0.28 Beta</a></bdi> <span class="bcsep">•</span> <span class="curid"><bdi><a href="https://sambapos.org/wiki/doku.php/en/v3.0.27_beta"  class="breadcrumbs" title="en:v3.0.27_beta">V3.0.27 Beta</a></bdi></span></div>
                    </div>
    


    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span>en:tracking_coffee_purchases_of_loyal_customers</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    
<p>
This page is read only. You can view the source, but not change it. Ask your administrator if you think this is wrong.
</p>
    <div class="editBox" role="application">

    <div class="toolbar group">
        <div id="draft__status" class="draft__status"></div>
        <div id="tool__bar" class="tool__bar"></div>
    </div>
    <form id="dw__editform" method="post" action="#" accept-charset="utf-8"><div class="no">
<input type="hidden" name="sectok" value="" /><input type="hidden" name="id" value="en:tracking_coffee_purchases_of_loyal_customers" /><input type="hidden" name="rev" value="0" /><input type="hidden" name="date" value="0" /><input type="hidden" name="prefix" value="." /><input type="hidden" name="suffix" value="" /><input type="hidden" name="changecheck" value="ca0cb2de919a1920c6d4085a4dd7a2cb" /><input type="hidden" name="target" value="section" /><textarea name="wikitext" id="wiki__text" dir="auto" class="edit" cols="80" rows="10" tabindex="1" readonly="readonly">
====== Tracking Coffee Purchases of Loyal Customers ======

If you read previous chapters you’ll get the idea. We’ll add a custom field to store promotion status of customer and when it reaches to a specific amount we’ll gift free coupons. 

If you didn’t do before I strongly suggest reading “SambaCard Tutorial”. This tutorial is about giving loyalty cards to customers. On this tutorial we’ll store promotion status on customer entity but if you want to enable this promotion for only Card Holders you can use SambaCard entity instead. Also you can have multiple promotions for different type of card holders. For example regular card receives free coffee for 6 purchases but gold card can receive it for 2 purchases.

===== Preparing Customer Entity =====

We’ll start by adding needed custom fields for customer.

{{:en:promotions:coupons47.jpg?700|}}

I’ve added a Number field named as Coffee Promotion. I’ve also enabled ''Hidden'' setting to hide this field on Customer listings.

On previous New Customer promotion document we’ve used Entity State feature to store if customer is a new customer or not. For this sample we can also use Entity State to store ''Coffee Promotion'' data because Entity States can also store numbers. If you want to make it editable through customer card use custom fields. If no use Entity States.

On next step we’ll add an action to update this field. We’ll use ''Update Entity Data'' action to change Coffee Promotion value. 

{{:en:promotions:coupons48.jpg?700|}}

When executed this action updates ''Coffee Promotion'' field value of the customer. While executing this action we’ll set customer name and promotion quantity so we defined them as variables. 

If you’ll create SambaCard entity you’ll choose that entity type instead of Customers. 

===== Preparing Tickets for Coffee Promotion =====

We need to understand a promotion product added into the ticket. On this sample this product is coffee so we’ll mark coffee order lines as promotion. Let’s create an action to mark coffee orders as promotion.

{{:en:promotions:coupons49.jpg?700|}}

We’ll use ''Update Order State'' action to change ''Promotion State'' of the order. When we add a new Coffee Order it’s order state should become ''Promotion Ordered''. When ticket paid we’ll update it to ''Promotion Paid'' and we’ll update Customer Data. Now we’ll create a rule to mark Coffee orders as promotion.

We’ll create a rule for ''Order Added to Ticket'' event. 

{{:en:promotions:coupons50.jpg?700|}}

I’ve created a constraint to understand if added product is Coffee or Not. If you want to enable promotion for multiple types of coffee you can add additional product names here by clicking ''Add Custom Constraint'' link. 

If added product is Coffee we’ll execute ''Update Order Promotion State'' action to change order state to ''Promotion Ordered''. 

When Ticket paid we’ll update order state to ''Promotion Paid'' so we’ll add another rule for that. 

We’ll handle ''Before Ticket Closing'' event and if remaining amount of ticket is 0 we’ll update orders marked as ''Promotion Ordered'' to ''Promotion Paid''.

{{:en:promotions:coupons51.jpg?700|}}

When we set ''Current State'' value it will change only orders that already have ''Promotion Ordered'' state. If we leave it empty it will change all order’s states to ''Promotion Paid''. This it not what we want for now but this feature might be handy in some cases. 

Now you can test if rules updates Coffee order states fine.

Until now we didn’t checked if a customer selected on ticket or not. We do not check it while adding orders because in some cases customers tells they have loyalty card just before payment. If needed you can add an additional action to reset order state to a different value other than ''Promotion Paid'' if no customer selected.

Our ticket is ready to handle Coffee Promotions. 

===== Updating Customer Data =====

We’ll handle ''Order State Updated'' event to update customer promotion count. 

{{:en:promotions:coupons52.jpg?700|}}

We’ll check if a customer is assigned or not here. On ''Update Customer Coffee Promotion Count'' action we’ll set Quantity parameter with ''{QUANTITY}'' tag. + sign behind tag means we’ll increase the value. So if 4 coffee ordered parameter becomes +4 and it increases Promotion Count on customer card by 4.

We can test how it works. As we sell coffee to a customer her Coffee Promotion Count should increase. 

{{:en:promotions:coupons53a.jpg?700|}}

{{:en:promotions:coupons53b.jpg?700|}}

  * Back to [[Promotion Coupons Documentation]]
  * Next Topic &gt; [[Giving Free Coffee]]</textarea>
<div id="wiki__editbar" class="editBar">
<div id="size__ctl">
</div>
</div>
</div></form>
</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>en/tracking_coffee_purchases_of_loyal_customers.txt</bdi> · Last modified: 2013/09/16 06:01 (external edit)</div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li class="show"><a href="https://sambapos.org/wiki/doku.php/en/tracking_coffee_purchases_of_loyal_customers?do=" title="Show page [v]" rel="nofollow" accesskey="v"><span>Show page</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13 9h5.5L13 3.5V9M6 2h8l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4c0-1.11.89-2 2-2m9 16v-2H6v2h9m3-4v-2H6v2h12z"/></svg></a></li><li class="revs"><a href="https://sambapos.org/wiki/doku.php/en/tracking_coffee_purchases_of_loyal_customers?do=revisions" title="Old revisions [o]" rel="nofollow" accesskey="o"><span>Old revisions</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11 7v5.11l4.71 2.79.79-1.28-4-2.37V7m0-5C8.97 2 5.91 3.92 4.27 6.77L2 4.5V11h6.5L5.75 8.25C6.96 5.73 9.5 4 12.5 4a7.5 7.5 0 0 1 7.5 7.5 7.5 7.5 0 0 1-7.5 7.5c-3.27 0-6.03-2.09-7.06-5h-2.1c1.1 4.03 4.77 7 9.16 7 5.24 0 9.5-4.25 9.5-9.5A9.5 9.5 0 0 0 12.5 2z"/></svg></a></li><li class="backlink"><a href="https://sambapos.org/wiki/doku.php/en/tracking_coffee_purchases_of_loyal_customers?do=backlink" title="Backlinks" rel="nofollow"><span>Backlinks</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10.59 13.41c.41.39.41 1.03 0 1.42-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l3.54-3.54a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.49 1.49c.01-.82-.12-1.64-.4-2.42l.47-.48a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-3.53 3.53a2.982 2.982 0 0 0 0 4.24m2.82-4.24c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-3.54 3.54a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.49-1.49c-.01.82.12 1.64.4 2.43l-.47.47a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l3.53-3.53a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42z"/></svg></a></li><li class="top"><a href="#dokuwiki__top" title="Back to top [t]" rel="nofollow" accesskey="t"><span>Back to top</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license" class="urlextern">CC Attribution-Share Alike 4.0 International</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license"><img src="https://sambapos.org/wiki/lib/images/license/button/cc-by-sa.png" alt="CC Attribution-Share Alike 4.0 International" /></a>        <a href="https://www.dokuwiki.org/donate" title="Donate" ><img
            src="https://sambapos.org/wiki/lib/tpl/dokuwiki/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="https://php.net/" title="Powered by PHP" ><img
            src="https://sambapos.org/wiki/lib/tpl/dokuwiki/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="https://sambapos.org/wiki/lib/tpl/dokuwiki/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="https://sambapos.org/wiki/lib/tpl/dokuwiki/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="https://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="https://sambapos.org/wiki/lib/tpl/dokuwiki/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="https://sambapos.org/wiki/lib/exe/indexer.php?id=en%3Atracking_coffee_purchases_of_loyal_customers&amp;1547095638" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div></body>

<!-- Mirrored from sambapos.org/wiki/doku.php/en/tracking_coffee_purchases_of_loyal_customers?do=edit by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 10 Jan 2019 04:52:44 GMT -->
</html>
